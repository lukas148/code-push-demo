machine:
  node:
    version: v4.2
  ruby:
    version: 2.2.3
dependencies:
  pre:
    # Setup for CodePush
    - npm install -g cordova code-push-cli ionic
    - code-push login --accessKey $CODE_PUSH_ACCESS_KEY
    # Setup cordova for generating build
    - ionic state restore
  cache_directories:
    - "www/lib/bower-components"
    - "plugins"
    - "platforms"
deployment:
  staging:
    branch: master
    commands:
      - gulp build
      - ionic upload --email $IONIC_EMAIL --password $IONIC_PASSWORD
      - ionic share h.tavakoli@sproutatwork.com
      - ionic share j.estacion@sproutatwork.com
      # Prepare builds
      - cordova prepare
      # Deploy to staging
      - code-push release $CODE_PUSH_APP_NAME ./platforms/ios/www/ $APP_STORE_VERSION --deploymentName ios -m
      - code-push release $CODE_PUSH_APP_NAME ./platforms/android/assets/www $APP_STORE_VERSION --deploymentName android -m
  post:
    - node ci-hook.js $CIRCLE_PROJECT_REPONAME
